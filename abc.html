<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroSetu | AI Assistant</title>
    <link rel="icon" href="logo.png" type="image/png">
    <link rel="stylesheet" href="style.css" />

    <script>
        document.addEventListener('contextmenu', e => e.preventDefault());
    </script>

    <style>
        /* ===== KEEP ORIGINAL CHAT STYLES (SLIGHTLY CONTAINED) ===== */
        body {
            padding: 0;
        }

        .assistant-wrapper {
            padding: 20px;
        }

        .chat-container {
            max-width: 500px;
            margin: 20px auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            height: 80vh;
            display: flex;
            flex-direction: column;
        }
    </style>
</head>

<body>

<!-- ===== HEADER (MATCHES INDEX.HTML) ===== -->
<header class="site-header">
    <div class="logo">AgroSetu</div>
    <button class="hamburger" onclick="toggleMenu()">‚ò∞</button>

    <nav id="navbar">
        <a href="index.html">Home</a>
        <a href="cropadvisory.html">Crop Advisory</a>
        <a href="weather.html">Weather</a>
        <a href="assistant.html" class="active">AI - Assistant</a>
        <a href="schemes.html">Govt Schemes</a>
        <a href="languages.html">Language</a>
    </nav>
</header>

<div style="display:flex; justify-content:flex-end; padding:8px 16px;">
    <button id="themeToggle"
        style="background:var(--accent); border:none; border-radius:50%;
        width:40px; height:40px; font-size:20px; cursor:pointer;">
        üåô
    </button>
</div>

<!-- ===== ASSISTANT CONTENT ===== -->
<div class="assistant-wrapper fade-in">

    <div class="chat-container">
        <div class="chat-header">
            <h1>üåæ Farmer Assistant</h1>
            <p>Your AI farming expert - Ask anything!</p>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                <div class="message-content">
                    Hello farmer! üëã I'm here to help with crops, soil, weather, pests,
                    and all your farming questions. What would you like to know today?
                </div>
            </div>
        </div>

        <div class="chat-input">
            <input type="text" id="userInput" placeholder="Ask about farming..."
                oninput="toggleSendButton()" onkeypress="handleKeypress(event)">
            <button id="sendBtn" onclick="sendMessage()">Send</button>
        </div>
    </div>

</div>

<footer class="fade-in"
    style="background:var(--accent); color:white; padding:20px; margin:20px auto;
    max-width:1100px; box-shadow:0 6px 20px var(--shadow);">
    ¬© 2025 AgroSetu | Designed for Accessible Agriculture
</footer>

<!-- ===== THEME + NAV SCRIPT (FROM INDEX) ===== -->
<script>
const themeBtn = document.getElementById("themeToggle");
const mobileNav = document.getElementById("navbar");

themeBtn.onclick = () => {
    const t = document.body.dataset.theme === "dark" ? "light" : "dark";
    document.body.dataset.theme = t;
    themeBtn.textContent = t === "dark" ? "‚òÄÔ∏è" : "üåô";
    localStorage.setItem("theme", t);
};

function toggleMenu() {
    mobileNav.classList.toggle("open");
}

const savedTheme = localStorage.getItem("theme");
if (savedTheme) {
    document.body.dataset.theme = savedTheme;
    themeBtn.textContent = savedTheme === "dark" ? "‚òÄÔ∏è" : "üåô";
}
</script>

<!-- ===== ORIGINAL CHATBOT SCRIPT (UNCHANGED) ===== -->
<script>
const API_KEY = "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";

let isProcessing = false;

function toggleSendButton() {
    const input = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    sendBtn.disabled = !input.value.trim() || isProcessing;
}

function handleKeypress(event) {
    if (event.key === 'Enter' && !isProcessing && document.getElementById('userInput').value.trim()) {
        sendMessage();
    }
}

async function sendMessage() {
    if (isProcessing) return;

    const input = document.getElementById('userInput');
    const messages = document.getElementById('chatMessages');
    const sendBtn = document.getElementById('sendBtn');

    const message = input.value.trim();
    if (!message) return;

    isProcessing = true;
    toggleSendButton();
    input.disabled = true;

    messages.innerHTML += `
        <div class="message user">
            <div class="message-content">${message}</div>
        </div>
    `;
    input.value = '';
    messages.scrollTop = messages.scrollHeight;

    messages.innerHTML += `
        <div id="typing" class="message bot">
            <div class="message-content">ü§î Thinking about your farm...</div>
        </div>
    `;
    messages.scrollTop = messages.scrollHeight;

    try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${API_KEY}`
            },
            body: JSON.stringify({
                model: 'gpt-4o-mini',
                messages: [
                    {
                        role: 'system',
                        content: 'You are a helpful farming assistant. Provide practical advice about crops, weather, soil, farming techniques, and agricultural best practices. Keep responses concise (under 150 words), farmer-friendly, and actionable.'
                    },
                    { role: 'user', content: message }
                ],
                max_tokens: 300,
                temperature: 0.7
            })
        });

        const data = await response.json();
        document.getElementById('typing').remove();

        messages.innerHTML += `
            <div class="message bot">
                <div class="message-content">${data.choices[0].message.content}</div>
            </div>
        `;

    } catch (error) {
        document.getElementById('typing').remove();
        messages.innerHTML += `
            <div class="message bot">
                <div class="message-content">Sorry farmer! Please try again.</div>
            </div>
        `;
    } finally {
        isProcessing = false;
        input.disabled = false;
        input.focus();
        toggleSendButton();
        messages.scrollTop = messages.scrollHeight;
    }
}

toggleSendButton();
</script>

</body>
</html>
